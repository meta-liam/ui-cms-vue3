# 权限

有bug,permissions 有问题， user.permissions 取代它。
修改权限后，要重新登录。

## JS 菜单

```JS
// src/lin/util/util.js
/**
 * 判断权限
 */
Utils.hasPermission = (permissions, route, user) => {
  // eslint-disable-line
  if (user?.admin) {
    return true
  }
  permissions = user.permissions
  if (route.permission) {
    return permissions.some(permission => route.permission.indexOf(permission) > -1)
  }
  return true
}
```

## API接口

```js http
// cms/user/permissions
  {"id":1,"nickname":"root","avatar":null,"admin":true,"email":null,
  "permissions":["core_user_add"]
  },
// 核心点："admin":true, "permissions":["core_user_add"]
```

## div 中的权限

```js
// https://doc.cms.talelin.com/client/authority.html#%E8%A7%86%E5%9B%BE%E6%8E%A7%E5%88%B6
<button v-permission="['修改信息','修改密码']">编辑</button>

// 或者

<div  v-permission="'搜索日志'">
  // 具体展示代码省略
</div>

<button v-permission="{ permission: '删除图书', type: 'disabled'}">删除</button>
```

## dom Power

```js

function isAllowed(permission, user, permissions) {
  if (user.admin) return true
  permissions = user.permissions
  if (typeof permission === 'string') {
    return permissions.includes(permission)
  }
  if (permission instanceof Array) {
    return permission.some(auth => permissions.indexOf(auth) >= 0)
  }
  return false
}
```
